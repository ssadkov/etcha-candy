# Marketplace Flow - ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ° NFT

## ğŸ¯ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUCTION HOUSE PROGRAM                    â”‚
â”‚          (Metaplex Ğ½Ğ° Solana Blockchain)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘
                            â”‚
                            â”‚ Connects via
                            â”‚ Auction House Address
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
              â–¼                           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   SELLER     â”‚           â”‚    BUYER     â”‚
      â”‚  (Bob)       â”‚           â”‚   (Alice)    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                           â”‚
              â”‚ 1. List NFT               â”‚ 2. Buy NFT
              â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NFT Ticket #001 â”‚          â”‚  SOL Payment    â”‚
    â”‚  Owner: Bob     â”‚          â”‚ 0.5 SOL         â”‚
    â”‚ Delegate: AHâœ“   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ Transfer                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     BLOCKCHAIN TRANSACTION             â”‚
    â”‚  - NFT: Bob â†’ Alice                    â”‚
    â”‚  - SOL: Alice â†’ Bob (0.475)            â”‚
    â”‚  - Fee: â†’ Auction House (0.0125 = 2.5%)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ»Ğ¸ÑÑ‚Ğ¸Ğ½Ğ³Ğ°:

### Ğ¨Ğ°Ğ³ 1: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ‚ÑŒ NFT
```
User: Bob
NFT: Ticket #001
Price: 0.5 SOL
Wallet: Bob's private key
```

### Ğ¨Ğ°Ğ³ 2: ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Auction House (Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸ 616-618)
```typescript
// ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Auction House Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğµ Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ
const auctionHouse = await userMetaplex.auctionHouse().findByAddress({
  address: new PublicKey(auctionHouseAddress),
});
```

Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚:
- âœ… Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ PDA Auction House Ñ Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğ° Solana
- âœ… ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (sellerFeeBasisPoints: 2.5%)
- âœ… Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ authority Ğ¸ treasury accounts

### Ğ¨Ğ°Ğ³ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸ÑÑ‚Ğ¸Ğ½Ğ³Ğ° (Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸ 621-625)
```typescript
const { listing } = await userMetaplex.auctionHouse().list({
  auctionHouse,                      // â† ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Auction House
  mintAccount: new PublicKey(nftMintAddress),
  price: lamports(priceInSol * 1e9), // â† Ğ¦ĞµĞ½Ğ° Ğ² lamports
});
```

Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğµ:
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ `SellerTradeState` PDA (1 Ğ±Ğ°Ğ¹Ñ‚)
   - Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ hash(price, NFT_address, seller)
   - ĞÑ‡ĞµĞ½ÑŒ Ğ´ĞµÑˆĞµĞ²Ğ°Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ (~0.01 SOL)
   
2. Delegate NFT Ğº Auction House
   ```typescript
   // Auction House ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ Ğ´ĞµĞ»ĞµĞ³Ğ°Ñ‚Ğ¾Ğ¼ NFT
   NFT.delegate = programAsSigner
   ```
   
3. NFT Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ² ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞµ Bob! âœ…
   - Bob Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ NFT
   - ĞœĞ¾Ğ¶ĞµÑ‚ ÑĞ½ÑÑ‚ÑŒ Ğ»Ğ¸ÑÑ‚Ğ¸Ğ½Ğ³ Ğ² Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚
   - ĞĞµ Ñ‚ĞµÑ€ÑĞµÑ‚ ownership Ğ´Ğ¾ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸

### Ğ¨Ğ°Ğ³ 4: ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğµ Auction House
```typescript
metaplex.auctionHouse().list()
         â†“
    SDK Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ:
    Instruction {
      programId: "metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"
      accounts: [
        seller,
        tokenAccount,
        metadata,
        auctionHouse,
        sellerTradeState
      ]
      data: { price, tokenAmount }
    }
         â†“
    Solana Blockchain Transaction
         â†“
    Auction House Program Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚:
    - Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ PDA SellerTradeState
    - Ğ”ĞµĞ»ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ NFT
    - ĞĞµ Ğ´Ğ²Ğ¸Ğ³Ğ°ĞµÑ‚ NFT Ğ¸Ğ· ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°!
```

## ğŸ” Ğ“Ğ´Ğµ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾ Ğ¼Ñ‹ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ?

### Ğ’ ĞºĞ¾Ğ´Ğµ:
```typescript:615:625:src/services/CandyMachineService.ts
// Ğ¨Ğ°Ğ³ 1: ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ Ğº Auction House
const auctionHouse = await userMetaplex.auctionHouse().findByAddress({
  address: new PublicKey(auctionHouseAddress),  // â† ĞĞ´Ñ€ĞµÑ Auction House PDA
});

// Ğ¨Ğ°Ğ³ 2: Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Metaplex Auction House
const { listing } = await userMetaplex.auctionHouse().list({
  auctionHouse,                                   // â† ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ Ğº ÑÑ‚Ğ¾Ğ¹ Auction House
  mintAccount: new PublicKey(nftMintAddress),    // â† ĞšĞ°ĞºĞ¾Ğ¹ NFT Ğ²Ñ‹ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼
  price: lamports(priceInSol * 1e9),             // â† Ğ—Ğ° ĞºĞ°ĞºÑƒÑ Ñ†ĞµĞ½Ñƒ
});
```

### ĞĞ° Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğµ:
```
Auction House Address (PDA Ğ½Ğ° Solana):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SellerFeeBasisPoints: 250 (2.5%)      â”‚
â”‚ Authority: Platform wallet             â”‚
â”‚ Treasury: Treasury wallet              â”‚
â”‚ Created: <date>                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ 1. findByAddress() - Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
         â”‚
SellerTradeState PDA (Ğ½Ğ¾Ğ²Ñ‹Ğ¹):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trade State Address (hash-based)      â”‚
â”‚ Contains: hash(price, NFT, seller)    â”‚
â”‚ Size: 1 byte (very cheap!)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚:

**Auction House â€” ÑÑ‚Ğ¾ ĞĞ• escrow!**

âŒ ĞĞ• Ñ‚Ğ°Ğº: NFT â†’ Escrow Account â†’ Ğ–Ğ´ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸

âœ… Ğ¢Ğ°Ğº: NFT â†’ ĞÑÑ‚Ğ°ĞµÑ‚ÑÑ Ñƒ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° â†’ Delegate â†’ ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ°

ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:
- âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ñ‚ĞµÑ€ÑĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ´ NFT
- âœ… ĞœĞ¾Ğ¶ĞµÑ‚ ÑĞ½ÑÑ‚ÑŒ Ğ»Ğ¸ÑÑ‚Ğ¸Ğ½Ğ³ Ğ² Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚
- âœ… ĞĞµÑ‚ Ñ€Ğ¸ÑĞºĞ° lose NFT Ğ² escrow
- âœ… ĞœĞ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğµ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¿Ğ»ĞµĞ¹ÑĞ¾Ğ²

## ğŸ”— ĞšĞ°ĞºĞ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Metaplex SDK (Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)                             â”‚
â”‚    â””â”€ metaplex.auctionHouse().list()                    â”‚
â”‚                                                          â”‚
â”‚ 2. Solana RPC Connection                                â”‚
â”‚    â””â”€ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğº devnet.solana.com                  â”‚
â”‚                                                          â”‚
â”‚ 3. Auction House Program (On-chain)                     â”‚
â”‚    â””â”€ MPL Auction House Program                         â”‚
â”‚       Address: metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s
â”‚                                                          â”‚
â”‚ 4. NFT Token Account                                     â”‚
â”‚    â””â”€ ĞĞ¤Ğ¢ Ğ² ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞµ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°                          â”‚
â”‚       + Delegate = programAsSigner                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ĞÑ‚Ğ²ĞµÑ‚ Ğ½Ğ° Ğ²Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ:

**Ğ“Ğ´Ğµ Ğ¼Ñ‹ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ Ğº Auction House?**

ĞÑ‚Ğ²ĞµÑ‚: **Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 616** - `findByAddress()` - ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ!

```typescript
const auctionHouse = await userMetaplex.auctionHouse().findByAddress({
  address: new PublicKey(auctionHouseAddress),  // â† Ğ’ĞĞ¢ Ğ¢Ğ£Ğ¢ ĞŸĞĞ”ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ•!
});
```

Ğ­Ñ‚Ğ¾:
- Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Auction House account Ñ Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğ° Solana
- Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (sellerFeeBasisPoints, authority, etc.)
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ AuctionHouse Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

Ğ—Ğ°Ñ‚ĞµĞ¼ Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞµ **621** - Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ°Ğ¼Ñƒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ»Ğ¸ÑÑ‚Ğ¸Ğ½Ğ³Ğ°:
```typescript
await userMetaplex.auctionHouse().list({
  auctionHouse,  // â† Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½ÑƒÑ Auction House
  ...
})
```

Ğ­Ñ‚Ğ¸ Ğ´Ğ²Ğ° ÑˆĞ°Ğ³Ğ° Ğ¸ ĞµÑÑ‚ÑŒ **Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Auction House**! ğŸ‰

